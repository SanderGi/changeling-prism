#!/bin/bash
#SBATCH -p general
#SBATCH -J main
#SBATCH -N 1
#SBATCH --gres=gpu:1
#SBATCH -c 14
#SBATCH --mem=40G
#SBATCH -t 20:00:00
#SBATCH --exclude=babel-m5-32
#SBATCH -o exp/slurm_logs/%A_%a.out
#SBATCH -e exp/slurm_logs/%A_%a.out

# === Directory Setup ===
cd /data/user_data/sbharad2/PRiSM
mkdir -p "exp/slurm_logs"
# === Environment setup ===
source setup_uv.sh .venv
# for w2v2ph these must be pre-built
export HYDRA_FULL_ERROR=1
export HF_HOME="/data/group_data/wavlab_icme25/PRiSM/exp/cache/hf"
export PHONEMIZER_ESPEAK_LIBRARY="/data/group_data/wavlab_icme25/espeak-ng/src/.libs/libespeak-ng.so.1.1.51"
export ESPEAK_DATA_PATH="/data/group_data/wavlab_icme25/espeak-ng/espeak-ng-data"
###########################
echo "RUNNING ON NODE: $(hostname)"
echo "START TIME: $(date)"
echo "SLURM_JOB_ID: $SLURM_JOB_ID"
nvidia-smi
export NCCL_P2P_DISABLE=1
echo "RunningCMD: python src/main.py $*"
###########################
python src/main.py "$@"
###########################
###########################